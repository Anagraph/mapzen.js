<!-- This example assumes you have local version of mapzen.min.js in dist folder -->
<!-- Please look at BUILD.md to build local version of mapzen.min.js -->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="stylesheet" href="../../dist/mapzen.css">
    <style>
      html, body {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #map {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script src="../../dist/mapzen.min.js"></script>
    <script>
      /* This example is to add a buffer to selected routes */

      L.Mapzen.apiKey ='vector-tiles-nccaBBc';
      var map = L.Mapzen.map('map', {
        tangramOptions: {
          scene: L.Mapzen.BasemapStyles.Refill
        }
      });

      var routingData = {
        waypoints: [
          L.latLng(37.752, -122.418),
          L.latLng(37.779, -122.391)
        ],
        costing: 'auto'
      }

      map.setView([37.752, -122.418], 13);

      L.Mapzen.hash({
        map: map
      })

      L.Mapzen.geocoder().addTo(map);

      var control = L.Mapzen.routing.control({
        waypoints: routingData.waypoints,
        // You can get your own Mapzen turn-by-turn & search API key from the Mapzen developer portal (https://mapzen.com/developers/)
        geocoder: L.Mapzen.routing.geocoder('search-RH8pVLv'),
        reverseWaypoints: true,
        router: L.Mapzen.routing.router('valhalla-PVA4Y8g', {costing: routingData.costing}),
        collapsible: true,
        fitSelectedRoutes: false, /* Turn off default behaviour */
        show: (map.getSize().x > 768)? true: false,
        summaryTemplate:'<div class="start">{name}</div><div class="info {costing}">{distance}, {time}</div>'
      }).addTo(map);

      L.Mapzen.routing.errorControl(control).addTo(map);

      control.on('routesfound', function (route) {
        /* We turned off the default behaviour of routing machine, which fits start and destination point to the map without buffer */
        /* We are setting our desired behaviour here (adding topLeft[100,100] buffer, with bottomRight [100, 100] buffer) */
        var allRoutesCoords = [];
        /* Collecting all the result route coordinates */
        for (var i = 0, j = route.routes.length; i < j; i++) {
          for(var k = 0, l = route.routes[i].coordinates.length; k < l; k++) {
            allRoutesCoords.push(route.routes[i].coordinates[k]);
          }
        }

        var bounds = L.latLngBounds(allRoutesCoords);
        map.fitBounds(bounds, {
          paddingTopLeft: [100, 100],
          paddingBottomRight: [100, 100]
        });
      });

      // to show where waypoints are even if there is no routing data
      control.on('routingerror', function () {
        var waypoints = control.getWaypoints();
        map.fitBounds([
          waypoints[0].latLng,
          waypoints[waypoints.length-1].latLng
        ]);
      })


    </script>
  </body>
</html>
